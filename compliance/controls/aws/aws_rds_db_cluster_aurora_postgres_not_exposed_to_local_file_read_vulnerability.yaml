id: aws_rds_db_cluster_aurora_postgres_not_exposed_to_local_file_read_vulnerability
title: RDS Aurora PostgreSQL clusters should not be exposed to local file read vulnerability
description: This control checks whether AWS Aurora PostgreSQL clusters are exposed to local file read vulnerability by ensuring that AWS RDS PostgreSQL instances use a non-vulnerable version of the log_fdw.
integration_type:
  - aws_cloud_account
parameters: []
policy:
    language: sql
    primary_resource: aws_rds_db_instance
    definition: |
        SELECT
          arn AS resource,
          platform_integration_id AS platform_integration_id,
          platform_resource_id AS platform_resource_id,
          CASE
            WHEN NOT engine ILIKE '%aurora-postgres%' THEN 'skip'
            WHEN engine ILIKE '%aurora-postgres%' AND engine_version LIKE ANY (ARRAY ['10.11', '10.12', '10.13', '11.6', '11.7', '11.8']) THEN 'alarm'
            ELSE 'ok'
          END AS status,
          CASE
            WHEN NOT engine ILIKE '%aurora-postgres%' THEN title || ' not Aurora PostgreSQL edition.'
            WHEN engine ILIKE '%aurora-postgres%' AND engine_version LIKE ANY (ARRAY ['10.11', '10.12', '10.13', '11.6', '11.7', '11.8']) THEN title || ' exposed to local file read vulnerability.'
            ELSE title || ' not exposed to local file read vulnerability.'
          END AS reason
        FROM
          aws_rds_db_instance;
severity: low
tags: {}
