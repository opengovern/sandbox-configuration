connectors:
- AWS
query: |-
  with cost_data as (
    select
      service,
      period_start,
      unblended_cost_amount as this_month,
      lag(unblended_cost_amount,-1) over(partition by service order by period_start desc) as previous_month
    from 
      aws_cost_by_service_monthly
  )
  select
      service,
      period_start,
      this_month::numeric::money,
      previous_month::numeric::money,
      case 
        when previous_month = 0 and this_month = 0  then 0
        when previous_month = 0 then 999
        else round((100 * ( (this_month - previous_month) / previous_month))::numeric, 2) 
      end as percent_change
  from
    cost_data
  order by
    service,
    period_start;
  
Title: "Steampipe Table: aws_cost_by_service_monthly - Query AWS Cost Explorer Service using SQL"
Description: "Allows users to query AWS Cost Explorer Service for monthly cost breakdown by service. This table provides details such as the service name, the cost associated with it, and the currency code."
