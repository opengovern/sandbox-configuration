ID: aws_iam_policy_no_full_access_to_kms
Title: IAM policy should not grant full access to KMS service
Description: KMS is a critical service and IAM policies should follow least privilege
  model for this service in particular. This control is non-compliant if the managed
  IAM policy allows full access to KMS service.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with cloudtrail_full_access_policies as (\n      select\n        arn,\n
    \       count(*) as statements_num\n      from\n        aws_iam_policy,\n        jsonb_array_elements(policy_std
    -> 'Statement') as s,\n        jsonb_array_elements_text(s -> 'Resource') as resource,\n
    \       jsonb_array_elements_text(s -> 'Action') as action\n      where\n        not
    is_aws_managed\n        and s ->> 'Effect' = 'Allow'\n        and resource = '*'\n
    \       and action = 'cloudtrail:*'\n      group by\n        arn\n    )\n    select\n
    \     p.arn as resource,\n      case\n        when w.arn is null then 'ok'\n        else
    'alarm'\n      end status,\n      p.name || ' contains ' || coalesce(w.statements_num,0)
    ||\n        ' statements that allow action \"*\" on at cloudtrail service on resource
    \"*\".' as reason\n      \n      \n    from\n      aws_iam_policy as p\n      left
    join cloudtrail_full_access_policies as w on p.arn = w.arn\n    where\n      not
    p.is_aws_managed;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: ""
