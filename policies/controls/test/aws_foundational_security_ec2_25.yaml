ID: aws_foundational_security_ec2_25
Title: 25 Amazon EC2 launch templates should not assign public IPs to network interfaces
Description: This control checks if Amazon EC2 launch templates are configured to
  assign public IP addresses to network interfaces upon launch. The control fails
  if an EC2 launch template is configured to assign a public IP address to network
  interfaces or if there is at least one network interface that has a public IP address.
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "    with public_launch_templates as (\n      select\n        i.tags
    ->> 'aws:ec2launchtemplate:id' as public_launch_template_id\n      from\n        aws_ec2_instance
    as i,\n        jsonb_array_elements(launch_template_data -> 'NetworkInterfaces')
    as nic\n      where\n        (nic -> 'AssociatePublicIpAddress')::bool\n    ),\n
    \   launch_templates_associated_instance as (\n      select\n        distinct
    tags ->> 'aws:ec2launchtemplate:id' as launch_template_id\n      from\n        aws_ec2_instance\n
    \   )\n    select\n      t.launch_template_id as resource,\n      case\n        when
    i.launch_template_id is null then 'skip'\n        when t.launch_template_id in
    ( select public_launch_template_id from public_launch_templates ) then 'alarm'\n
    \       else 'ok'\n      end as status,\n      case\n        when i.launch_template_id
    is null then t.title || ' does not launch any instance.'\n        when t.launch_template_id
    in ( select public_launch_template_id from public_launch_templates ) then t.title
    || ' publicly accessible.'\n        else t.title || ' not publicly accessible.'\n
    \     end as reason\n      \n      \n    from\n      aws_ec2_launch_template as
    t\n      left join launch_templates_associated_instance as i on i.launch_template_id
    = t.launch_template_id;\n"
  Connector:
  - aws
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
  Global: false
Tags: {}
Severity: high
